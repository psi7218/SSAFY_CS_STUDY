# 실시간 양방향 통신

### 📌 실시간 양방향 통신
- 우리가 웹이나 앱을 만들 때 자주 접하는 기술
  - ex. 채팅 앱에서 메시지가 바로 뜨거나, 주식 앱에서 가격이 즉시 반영
- "실시간 양방향 통신 기술"을 활용해 브라우저가 서버로부터 즉시 데이터를 받는 기술

<br/>
<br/>

### 1️⃣ 롱 폴링 (Long Polling)

- 과거 실시간 통신이 없던 시절, "실시간처럼 보이게 하자"는 아이디어에서 시작
- 클라이언트가 계속 서버에 요청을 보내고, 서버는 기다리다가 변경이 생기는 경우 알려주는 방식.
- 응답 이후에는 연결이 종료되고, 클라이언트는 또 물어보는 걸 반복
- 어디서나 사용 가능하지만, 네트워크 낭비가 크고 반응 속도가 느림

- 통신 흐름
  - 클라이언트가 서버에 HTTP 요청 보냄
  - 서버는 응답을 기다리다 새 데이터가 생기면 응답함
  - 클라이언트는 다시 요청
  - 이 과정을 계속 반복


<br/>
<br/>

### 2️⃣ 웹소켓 (WebSocket)
- 클라이언트와 서버가 연결을 한 번 맺으면, 계속 연결된 상태로 유지됨
- 양쪽에서 자유롭게 데이터를 주고받을 수 있는 진짜 양방향 통신
- 채팅, 게임, 협업 앱처럼 즉각적인 반응이 필요한 경우에 적합
- 설정이 다소 복잡하고, 네트워크 환경에 따라 연결이 끊기기도 함

- 통신 흐름
  - 클라이언트가 Upgrade: websocket 헤더로 연결 요청
  - 서버가 수락하면 WebSocket 연결로 전환
  - 이후 연결 유지 & 양방향 데이터 송수신 가능

<br/>
<br/>

### 3️⃣ SSE (Server-Sent Events)
- 서버 → 클라이언트 방향으로만 일방적으로 데이터를 푸시
- 브라우저는 EventSource로 연결 유지, 서버는 새 데이터 생길 때마다 전송
- 설정이 간단하고 자동 재연결 기능도 내장
- 클라이언트 → 서버 전송은 불가능하거나 매우 제한적

- 통신 흐름
  - 클라이언트가 /events로 연결
  - 서버가 text/event-stream 형식으로 데이터 푸시
  - 연결 유지 & 새로운 이벤트 발생 시마다 전달
  - 연결 끊기면 브라우저가 자동 재연결 시도

<br/>
<br/>

### 4️⃣ 웹트랜스포트 (WebTransport)
- HTTP/3 + QUIC 기반의 차세대 실시간 통신 기술
- 웹소켓보다 더 빠르고 유연함, 다양한 스트림을 동시에 생성 가능
- 신뢰성 있는 전송, 없는 전송 모두 지원
- 고성능 앱, 실시간 게임 등에 적합
- 아직 실험적 단계, 브라우저와 서버 모두 완전하게 지원해주지 않음. 표준화 진행 중

- 통신 흐름
  - 클라이언트가 HTTP/3로 서버에 연결
  - 서버가 WebTransport 세션 수락
  - 단방향/양방향 스트림 각각 생성 가능
  - 스트림마다 독립적인 데이터 전송 가능

<br/>
<br/>

### 5️⃣ WebRTC
- 영상통화, 음성통화 같은 미디어 통신을 위해 만들어진 기술
- **브라우저끼리 직접 연결(P2P)**하여 미디어/데이터 송수신
- 화상회의, 화면 공유 등에 사용
- 설정이 복잡하고, 일반 실시간 메시징 용도로는 비효율적
- 싸피에서는 주로 OpenVidu 많이 사용

- 통신 흐름
  - 시그널링 서버 통해 연결 정보 교환
  - STUN/TURN 서버 통해 브라우저 간 직접 연결 시도
  - 연결 후에는 미디어/데이터 직접 송수신

<br/>

#### 쿠렌토(Kurento)와 오픈비두(OpenVidu)
- Kurento: 미디어 서버 엔진 (상대적으로 복잡)
  - WebRTC 기반으로 동작하는 오픈소스 미디어 서버 엔진
  - 미디어 파이프라인 구조를 제공 → 영상에 필터 적용, 녹화, 모자이크, 얼굴 인식 등을 자유롭게 조합 가능
  
- OpenVidu: Kurento 기반 라이브러리 (쉽고 빠름)
  - 복잡한 Kurento API를 감싸서, WebRTC 기능을 쉽고 빠르게 구현 가능
  - 화상회의, 화면 공유, 다자간 회의, 녹화 등 대부분의 기능이 이미 구현돼 있음
  - Docker로 쉽게 설치 가능, 배포도 편리함






- 참고 링크
  - 원문 : https://rxdb.info/articles/websockets-sse-polling-webrtc-webtransport.html